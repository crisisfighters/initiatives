<!DOCTYPE HTML>
<html>
<head>
    <title>Alexander Thiel</title>
    <meta charset="utf-8"/>
    <link href="style.css" rel="stylesheet" type="text/css">
</head>
<body>
<h1>Extinction Fighters</h1>
<p>
    This website wants to collaboratively collect and assess initiatives fighting extinction.<br/>
    Extinction refers to the breakdown of civilization due to the unmitigated climate and biodiversity crises.<br/>
    We sympathize but are not affiliated with <a href="https://rebellion.earth/">extinction rebellion</a>.</p>

<hr/>
<h1>Initiatives</h1>
<p>The following data needs to be updated and improved by all of us. Please scroll down to find out how to <a
        href="#contribute">contribute</a> - it's simple!</p>
<table id="grid2">
    <thead>
    </thead>
    <tbody>
    </tbody>
</table>
<hr/>
<a name="contribute"/>
<h1>Contribute</h1>
<p>You can <b>add initiatives</b>, <b>update data</b> and make other changes to this website - it's open source and easy to improve.<br/>
Please go to <a
        href="https://github.com/extinctionfighters/initiatives#user-content-extinction-fighters">github.com/extinctionfighters/initiatives</a> (scroll
    down the page) to contribute.</p>
<p>If you don't have a GitHub account or are not used to it (yes, it's a bit nerdy), drop us an email at <a
        href="mailto:hello@extinctionfighters.org">hello@extinctionfighters.org</a>!</p>

<hr/>
<p>Made with üòÄ and ‚ù§Ô∏è on üåè</p>

<script src="data.js"></script>
<script src="fields.js"></script>
<script>

    (() => {

        document.querySelector("#grid2 thead")
            .insertAdjacentHTML(
                'beforeend',
                Object.keys(fields)
                    .reduce(
                        (acc, group) => [
                            [
                                ...acc[0],
                                `<th class="${group}" colspan="${Object.keys(fields[group].children).length}">${fields[group].title}</th>`
                            ],
                            [
                                ...acc[1],
                                ...Object.keys(fields[group].children).map(field => `<th class="${group}">${fields[group].children[field].title}</th>`),
                            ],
                        ],
                        [[], []]
                    )
                    .map(thSet => `<tr>${thSet.join('\n')}</tr>`)
                    .join('\n'));


        const flatFields = Object.keys(fields)
            .reduce(
                (acc, group) => ({
                    ...acc,
                    ...fields[group].children
                }),
                {});

        const render = content =>
            `<td>${
                content === undefined
                    ? '-'
                    : typeof content === "string"
                    ? content
                    : `<span class="updated">${content.updatedBy} (${content.updatedAt}):</span>${content.content}`
                }</td>`
        ;

        document.querySelector("#grid2 tbody")
            .insertAdjacentHTML(
                'beforeend',
                data.map(row => `<tr>${
                    Object.keys(flatFields)
                        .map(field => render(row[field]))
                        .join('')
                    }</tr>`)
                    .join('\n')
            );
    })();
</script>
</body>
</html>